# Документација за Event Planner API

## Вовед

Event Planner API е RESTful сервер развиен со Express.js кој обезбедува функционалности за управување со настани, предмети и нотификации. Податоците се зачувуваат во PostgreSQL база на податоци.

## Инсталација и стартување

### Претпоставки

* Node.js и npm се инсталирани
* PostgreSQL сервер е конфигуриран

### Чекори за стартување

1. Клонирај го проектот:

   ```bash
   git clone <репозиториум линк>
   ```
2. Инсталирај ги зависностите:

   ```bash
   npm install
   ```
3. Конфигурирај ја базата на податоци во `Pool` објектот:

   ```javascript
   const pool = new Pool({
       user: 'postgres',
       host: 'localhost',
       database: 'event_planner_db',
       password: 'postgres',
       port: 5432,
   });
   ```
4. Стартувај го серверот:

   ```bash
   node index.js
   ```

   Серверот ќе биде достапен на `http://localhost:3000`.

## Middleware

* `cors`: Овозможува Cross-Origin Resource Sharing.
* `express.json()`: Го обработува JSON телото на барањата.

## Рути и Ендпоинти

### Home Route

**GET /**

* Одговор: Добредојдовна порака.

### Items API

#### 1. Сите предмети

**GET /api/items**

* Опис: Ги враќа сите предмети од табелата `items_table`.
* Одговор: JSON објект со предметите.

#### 2. Предмети по категорија

**GET /api/items/category/\:category\_id**

* Опис: Ги враќа сите предмети со одредена `category_id`.
* Одговор: JSON објект со предметите од категоријата.

#### 3. Предмети по подкатегорија

**GET /api/items/subcategory/\:subcategory\_id**

* Опис: Ги враќа сите предмети со одредена `subcategory_id`.
* Одговор: JSON објект со предметите од подкатегоријата.

### Events API

#### 1. Сите настани

**GET /events**

* Опис: Ги враќа сите настани од табелата `events`.
* Одговор: JSON објект со настаните.

#### 2. Креирање на настан

**POST /events**

* Опис: Додава нов настан.
* Телото на барањето:

  ```json
  {
      "name": "Име на настан",
      "date": "2025-05-26",
      "location": "Локација",
      "description": "Опис на настан"
  }
  ```
* Одговор: Успешно креиран настан.

#### 3. Настан по ID

**GET /events/\:id**

* Опис: Го враќа настанот со одредено ID.
* Одговор: JSON објект со детали за настанот.

#### 4. Ажурирање на настан

**PUT /events/\:id**

* Опис: Ги ажурира податоците за настанот со одредено ID.
* Телото на барањето:

  ```json
  {
      "name": "Ажурирано име",
      "date": "2025-05-27",
      "location": "Нова локација",
      "description": "Нов опис"
  }
  ```
* Одговор: Успешно ажуриран настан.

#### 5. Бришење на настан

**DELETE /events/\:id**

* Опис: Го брише настанот со одредено ID.
* Одговор: Порака за успешна бришење.

### Notifications API

#### 1. Креирање на нотификација

**POST /api/notifications**

* Опис: Додава нова нотификација за корисник.
* Телото на барањето:

  ```json
  {
      "user_id": 1,
      "message": "Ваша нотификација"
  }
  ```
* Одговор: Успешно креирана нотификација.

#### 2. Нотификации за корисник

**GET /api/notifications/\:user\_id**

* Опис: Ги враќа сите нотификации за даден корисник сортирани по датум.
* Одговор: JSON објект со нотификациите.

#### 3. Ознака на нотификација како прочитана

**PUT /api/notifications/\:id/read**

* Опис: Ја означува нотификацијата како прочитана.
* Одговор: Успешна операција и ажурирана нотификација.

## Заклучок

Овој API овозможува лесно управување со настани, предмети и нотификации, што го прави идеален за апликации за организирање настани.

# Frontend Компоненти

---

## AddResourcePopup

Popup форма за додавање нов ресурс.

**Props:**

- `isOpen` (bool) - дали popup е отворен
- `onClose` (func) - функција за затворање
- `user` (object) - корисникот што додава ресурс

**Функционалност:**

- Внесување опис, количина, категорија и тип ресурс
- Чита категории и типови од вграден објект
- Чува ресурс во Firebase Firestore
- Прикажува грешки и состојба на вчитување

---

## EventCard

Картичка што прикажува основни информации за настан.

**Props:**

- `event` (object) - настан со полиња: `id`, `userId`, `date`, `title`, `location`, `startTime`, `endTime`, `resources`, `isPrivate`

**Функционалност:**

- Вчитува и прикажува име на креаторот од Firestore
- Форматира датум (ден, број, месец)
- При кликање пренасочува на детална страница
- Прикажува ресурси и приватен статус

---

## EventCarousel

Прикажува карусел со сите настани на корисникот.

**Props:**

- `user` (object) - моментално најавениот корисник

**Функционалност:**

- Вчитува настани од Firestore каде `userId` е ID на корисникот
- Прикажува порака доколку нема настани
- Прикажува `EventTicket` компоненти за секој настан
- Прикажува "Loading..." додека чека на податоци

---

---

## EventGrid

Мрежа (grid) која прикажува список на настани, филтрирани според видливост и пребарување.

**Props:**

- `user` (object) - тековен корисник

**Функционалност:**

- Вчитува јавни или приватни настани од Firestore според URL патека
- Реагира на промени во базата со `onSnapshot`
- Пребарување по наслов, локација и опис
- Прикажува порака кога нема настани
- Прикажува `EventCard` компоненти во мрежа

---

## EventTicket

Прикажува настан во „картичка“ стил со опции за бришење.

**Props:**

- `event` (object) - објект со детали за настанот
- `onRemove` (func) - функција за бришење на настан

**Функционалност:**

- Форматира и прикажува датум и време
- Прикажува приватен статус ако постои
- Копче за бришење со потврда (confirm)
- Пречекорува клик на бришење за да спречи навигација

---

# Компонента: ItemCard

Компонента за прикажување на поединечен ресурс (предмет) со неговите основни информации.

## Props

- `resource` (објект) — содржи податоци за ресурсот:
  - `name` (string) — име на ресурсот.
  - `category` (string) — категорија на ресурсот.
  - `description` (string) — опис на ресурсот.
  - `quantity` (number) — вкупна количина.
  - `available` (number) — количина на слободни ресурси.

## Опис

- Прикажува заглавје со име и категорија.
- Прикажува опис и статистики за вкупна и слободна количина.
- Стилови се влечат од `./css/ItemCard.css`.

---

# Компонента: ItemCarousel

Компонента која ја прикажува листата со ресурси на корисникот, овозможува уредување и бришење на ресурси.

## Props

- `user` (објект) — тековен корисник (Firebase user објект).

## Функционалности

- Вчитува ресурси од Firebase Firestore базата за конкретниот корисник (`user.uid`).
- Прикажува ресурси во мрежа со нивните информации.
- Овозможува уредување на ресурс со popup форма.
- Овозможува бришење на ресурс со потврда.
- Прикажува порака кога нема ресурси или кога е во процес на вчитување.
- Користи Firebase функциите: `collection`, `query`, `where`, `onSnapshot`, `deleteDoc`, `doc`, `updateDoc`.
- Стилови се влечат од `./css/ItemCarousel.css`.

## Како се користи

1. Примете го објектот `user` од родител компонента.
2. Компонентата автоматски ќе ги вчита ресурсите на корисникот.
3. Клик на иконата за уредување отвора форма за уредување.
4. Клик на иконата за бришење отвора потврда за бришење.

---

# Забелешки

- За корисничкиот интерфејс и потврди, се користат popup прозорци (overlay).
- При уредување, слободната количина се ресетира да одговара на вкупната.
- При бришење, по потврда ресурсот се брише од базата.

# Navbar Компонента

**Опис:**  
`Navbar` е React компонента која ја прикажува горната навигациона лента на апликацијата. Вклучува поздравување на најавениот корисник со нивното име, икона за известувања и копче за одјава. Сите податоци за корисникот и известувањата се влечат од Firebase Firestore.

**Клучни функции:**  
- Прикажува име на корисникот (преземено од Firestore).
- Вклучува компонента `NotificationBell` за известувања.
- Дава копче за одјава (`Logout`).
- При ажурирање на корисникот се повикуваат функции за вчитување на кориснички податоци и известувања.
- Маркирање известувања како прочитани преку API повици.

**Клучни технологии:**  
React, Firebase Firestore, React Router

---

# NotificationBell Компонента

**Опис:**  
`NotificationBell` е React компонента која ги прикажува и управува со известувањата на корисникот. Прикажува број на непрочитани известувања, листа со известувања и овозможува интеракција како прифаќање или одбивање понуди.

**Клучни функции:**  
- Следи известувања во реално време од Firebase Firestore (`onSnapshot`).
- Маркира известувања како прочитани.
- Прикажува детали за понуди и контакт информации.
- Управува со одговори на понуди (прифаќање/одбивање).
- Ажурира ресурси поврзани со понудата.
- Прикажува пораки за успешни акции.

**Клучни технологии:**  
React, Firebase Firestore, Firebase Realtime Updates, serverTimestamp

---

# Употреба

- За `Navbar` компонента:  
  ```jsx
  import Navbar from './components/Navbar';
  <Navbar user={user} />

---

# ProtectedRoute Компонента

Компонентата `ProtectedRoute` се користи за заштита на рутите во апликацијата. Го проверува дали корисникот е логирани (автентификуван) преку Firebase Authentication. Ако корисникот не е логирани, го пренасочува кон `/login` страница.

### Сигнатура
```jsx
<ProtectedRoute>
  {children}
</ProtectedRoute>

# Sidebar Компонента

Компонентата `Sidebar` претставува странична навигациона лента која овозможува навигација низ различни делови на апликацијата.

## Опис

- Преку `window.location.pathname` се одредува тековната локација во апликацијата.
- Прикажува четири навигациски копчиња со икони и текст:
  - **Профил** (`/profile`)
  - **Јавни настани** (`/events/public`)
  - **Приватни настани** (`/events/private`)
  - **Корисници** (`/users`)
- Активниот таб (линк) добива класа `active` која може да се искористи за стилизирање.
- Иконите се вградени SVG-слики, што овозможува лесно прилагодување на големина и боја.
- Во кодот е оставен коментиран state и handle функција за активен таб, кои можат да се вклучат доколку се посака пофина контрола на изборот.

## Користење

Само вметни ја компонентата каде што ти треба:

```jsx
import Sidebar from './Sidebar';

function App() {
  return (
    <div>
      <Sidebar />
      {/* Други компоненти */}
    </div>
  );
}

# UserGrid Компонента

Компонентата `UserGrid` прикажува мрежа од корисници со опција за пребарување и детален приказ на избран корисник и неговите ресурси.

## Опис

- Го вчитува списокот на корисници од Firebase Firestore колекцијата `users`.
- Имплементира пребарување по име, презиме и е-пошта (case insensitive).
- Кога се кликне на копчето "Детали" кај корисник, се вчитуваат поврзаните ресурси од колекцијата `resources` за тој корисник.
- Прикажува модален прозорец со детали за корисникот и листа на негови ресурси.
- При вчитување се прикажува текст "Вчитување...".
- Доколку нема пронајдени корисници за дадената пребарувачка фраза, се прикажува порака за празна листа.
- Користи икони од `react-icons/fa` за телефон и затворање.

## Функционалности

- **Пребарување:** Филтрира корисници според внесената вредност во полето за пребарување.
- **Детали:** Прикажува подетални информации за корисникот, вклучувајќи го и неговиот телефон (ако постои).
- **Ресурси:** Прикажува ресурси поврзани со корисникот, вчитани динамично од Firebase.
- **Модален прозорец:** Позадина која се затемнува и прозорец со деталите кој може да се затвори со копче.

## Пример на користење

```jsx
import UserGrid from './UserGrid';

function App() {
  return (
    <div>
      <UserGrid />
    </div>
  );
}

# Auth Context и Provider

Ова е React контекст и провајдер за аутентификација, базирани на Firebase Authentication.

## Опис

- Креира React контекст `AuthContext` кој го чува тековниот корисник и статусот на вчитување.
- Компонентата `AuthProvider` обезбедува контекст за сите компоненти во апликацијата.
- Користи Firebase функцијата `onAuthStateChanged` за слушање на промени во аутентикацискиот статус (најава/одјава).
- Поставува `user` state со тековниот корисник или `null` ако не е најавен.
- Додека е во процес на вчитување, не ги прикажува децата компоненти (`children`).
- Хукот `useAuth` овозможува лесен пристап до `user` и `loading` вредностите од контекстот.

## Компоненти

### AuthProvider

Обвива компоненти за да им овозможи пристап до аутентификацискиот контекст.

```jsx
<AuthProvider>
  <App />
</AuthProvider>

# ContactPopup Компонента

React компонента за прикажување попап прозорец каде корисникот може да испрати порака до креаторот на настанот.

---

## Опис

- Попап кој се појавува кога `isOpen` е `true`.
- Има текстуално поле за внесување порака.
- Се затвора при клик надвор од попапот или со клик на копчето за затворање.
- При испраќање на формата се повикува `onClose` callback.
- Моментално пораката се печати во конзола (во реална апликација треба да се испрати на backend).

---

## Проперти (Props)

| Име          | Тип               | Опис                                            |
|--------------|-------------------|------------------------------------------------|
| `isOpen`     | `boolean`         | Контролира дали попапот е отворен или затворен |
| `onClose`    | `function`        | Функција која се повикува кога попапот се затвора |
| `eventCreator` | `object/string`  | Информации за креаторот на настанот (не се користи во кодот, може да се искористи за прикажување или испраќање порака) |

---

## Пример за употреба

```jsx
import React, { useState } from 'react';
import ContactPopup from './ContactPopup';

const App = () => {
  const [popupOpen, setPopupOpen] = useState(false);

  return (
    <div>
      <button onClick={() => setPopupOpen(true)}>Контактирај креатор</button>
      <ContactPopup
        isOpen={popupOpen}
        onClose={() => setPopupOpen(false)}
        eventCreator={{ name: "Име на креатор" }}
      />
    </div>
  );
};

# EventCard Компонента

React компонента која прикажува картичка со информации за настан.

---

## Опис

- Прикажува датум (ден, број на ден, месец).
- Прикажува информации за настанот:
  - Име на креаторот (икона + текст).
  - Наслов на настанот.
  - Локација (икона + текст).
  - Време на настанот (икона + текст).
- Прикажува тагови за ресурси со случајни броеви.
- Има копче за „понуди ресурси“ кое отвора попап форма за контактирање на креаторот.
- Попапот содржи textarea и копче за испраќање порака (формата ја затвора попапот).

---

## Проперти (Props)

| Име      | Тип     | Опис                                |
|----------|---------|------------------------------------|
| `index`  | `number`| Индекс што се користи за прикажување број на ден |

---

## Пример за употреба

```jsx
import React from 'react';
import EventCard from './EventCard';

const App = () => {
  return (
    <div>
      <EventCard index={0} />
      <EventCard index={1} />
      <EventCard index={2} />
    </div>
  );
};



